# Firebase Document Purger (FBPURGE)

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)

## ğŸ“ Description

**Firebase Document Purger (FBPURGE)** est une application web moderne permettant de supprimer en masse des documents Firestore selon un critÃ¨re prÃ©cis, via une interface graphique simple et sÃ©curisÃ©e. Elle est conÃ§ue pour le dÃ©veloppement local et le nettoyage rapide de collections de test.

Deux modes sont proposÃ©s :
- **Client SDK** : suppression directe depuis le navigateur (rÃ¨gles Firestore permissives requises)
- **Admin SDK (Cloud Function)** : suppression via une Cloud Function callable (plus sÃ©curisÃ©, recommandÃ©)

## âš ï¸ Avertissement SÃ©curitÃ©

> **Cet outil est UNIQUEMENT destinÃ© au dÃ©veloppement local ou Ã  des environnements de test.**
> - **Ne jamais utiliser en production** ou sur des donnÃ©es sensibles.
> - Les suppressions sont **irrÃ©versibles**.
> - En mode Client SDK, vos rÃ¨gles Firestore doivent Ãªtre strictes en production.
> - En mode Admin SDK, sÃ©curisez l'accÃ¨s Ã  votre Cloud Function.

## ğŸ¨ Interface Utilisateur

L'interface web (voir `index.html` et `style.css`) propose :
- Un choix du mode :
  - **Client SDK (Direct Browser)**
  - **Admin SDK (via Cloud Function)**
- Un champ pour coller la configuration Firebase (Client SDK)
- Un champ pour le nom de la Cloud Function (mode Admin uniquement)
- Les champs de critÃ¨re :
  - **Nom de la collection** (ex : `utilisateurs_tests`)
  - **Champ de critÃ¨re** (ex : `statut`)
  - **Valeur du champ** (ex : `inactif`, `123`, `true`)
  - **Type de la valeur** (String, Number, Boolean)
- Un bouton **DÃ©marrer la Purge**
- Une boÃ®te de message pour le retour utilisateur (succÃ¨s, erreur, info)
- Un avertissement de sÃ©curitÃ© trÃ¨s visible

L'UI est responsive, moderne et accessible.

## ğŸš€ Installation & Lancement

1. Clonez ou tÃ©lÃ©chargez ce dÃ©pÃ´t.
2. Ouvrez `index.html` dans un navigateur moderne (support ES6 et modules).
3. Aucun serveur n'est requis pour l'usage local.

## âš™ï¸ Configuration

### 1. RÃ©cupÃ©rer la configuration Firebase
- Depuis la [console Firebase](https://console.firebase.google.com/), allez dans les paramÃ¨tres du projet > "Vos applications" > Web > copiez l'objet `firebaseConfig`.
- Collez-le dans le champ prÃ©vu de l'interface (exemple)Â :

```js
const firebaseConfig = {
  apiKey: "...",
  authDomain: "...",
  projectId: "...",
  storageBucket: "...",
  messagingSenderId: "...",
  appId: "..."
};
```

### 2. (Optionnel) DÃ©ployer la Cloud Function (mode Admin SDK)
- Initialisez les fonctions :

```bash
firebase init functions
```

- Ajoutez dans `functions/index.js`Â :

```js
const functions = require('firebase-functions');
const admin = require('firebase-admin');
if (!admin.apps.length) admin.initializeApp();
exports.deleteDocumentsByQuery = functions.https.onCall(async (data, context) => {
  const { collectionName, fieldName, fieldValue, fieldValueType } = data;
  if (!collectionName || !fieldName || fieldValue === undefined) {
    throw new functions.https.HttpsError('invalid-argument', 'ParamÃ¨tres invalides');
  }
  const db = admin.firestore();
  let parsedFieldValue = fieldValue;
  switch (fieldValueType) {
    case 'number': parsedFieldValue = parseFloat(fieldValue); break;
    case 'boolean': parsedFieldValue = String(fieldValue).toLowerCase() === 'true'; break;
    default: parsedFieldValue = String(fieldValue);
  }
  try {
    const snapshot = await db.collection(collectionName).where(fieldName, '==', parsedFieldValue).get();
    if (snapshot.empty) return { status: 'success', deletedCount: 0 };
    const batch = db.batch();
    snapshot.docs.forEach(doc => batch.delete(doc.ref));
    await batch.commit();
    return { status: 'success', deletedCount: snapshot.size };
  } catch (error) {
    throw new functions.https.HttpsError('internal', error.message);
  }
});
```

- DÃ©ployezÂ :

```bash
firebase deploy --only functions
```

- Notez le nom de la fonction (ex : `deleteDocumentsByQuery`) et renseignez-le dans l'UI.

## ğŸ–±ï¸ Utilisation

1. Ouvrez `index.html` dans votre navigateur.
2. Choisissez le mode (Client SDK ou Admin SDK).
3. Collez votre configuration Firebase.
4. (Mode Admin) Indiquez le nom de la Cloud Function.
5. RenseignezÂ :
   - Nom de la collection
   - Champ de critÃ¨re
   - Valeur du champ
   - Type de la valeur
6. Cliquez sur **DÃ©marrer la Purge**.
7. Confirmez l'opÃ©ration (popup de confirmation).
8. Consultez le message de rÃ©sultat en bas de page.

## ğŸ’¡ Fonctionnement technique

- **Client SDK**Â : Utilise le SDK Firestore dans le navigateur pour requÃªter et supprimer les documents (batch).
- **Admin SDK**Â : Appelle la Cloud Function via le SDK Functions, qui effectue la suppression cÃ´tÃ© serveur (plus sÃ©curisÃ©).
- Les messages d'Ã©tat (succÃ¨s, erreur, info) sont affichÃ©s dans une boÃ®te dÃ©diÃ©e.
- L'UI est entiÃ¨rement responsive et accessible.

## ğŸ¤ Contribution

Contributions, issues et suggestions sont les bienvenues !

## ğŸ“„ Licence

Ce projet est sous licence [MIT](https://opensource.org/licenses/MIT).